import React, { useEffect } from "react";
import MetaData from "../layout/MetaData";
import { useOrderDetailsQuery } from "../../redux/api/orderApi";
import toast from "react-hot-toast";
import { useParams, Link } from "react-router-dom";
import Loader from "../layout/Loader";

function OrderDetails() {
    const params = useParams();
    const { data, isLoading, error } = useOrderDetailsQuery(params?.id);
    console.log(data);
    //  soit passer par data.id ou bien assigné order = data?.order comme ca on fait directement order.id
    const order = data?.order || {};
    //  on prends les élement qui nous faut
    const {
        shippingInfo,
        orderItems,
        paymentInfo,
        paymentMethod,
        user,
        totalAmount,
        orderStatus,
    } = order;
    //  récup username , si user est un objet tu prends son nom
    const userName = typeof user === "object" ? user?.name : user;
    useEffect(() => {
        if (error) {
            toast.error(error?.data?.message);
        }
    }, [error]);

    return (
        <>
            <div className="container">
                <MetaData />
                <div className="row d-flex justify-content-center">
                    <div className="col-12 col-lg-9 mt-5 order-details">
                        <div className="d-flex justify-content-between align-items-center">
                            <h3 className="mt-5 mb-4">Your Order Details</h3>
                            <a
                                className="btn btn-success"
                                href="/invoice/order/order-id"
                            >
                                <i className="fa fa-print"></i> Invoice
                            </a>
                        </div>
                        <table className="table table-striped table-bordered">
                            <tbody>
                                <tr>
                                    <th scope="row">ID</th>
                                    <td>{order._id}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Status</th>
                                    <td className="greenColor">
                                        <b>{orderStatus}</b>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">Date</th>
                                    <td>
                                        {new Date(
                                            order?.createdAt
                                        ).toLocaleString("en-US")}
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <h3 className="mt-5 mb-4">Shipping Info</h3>
                        <table className="table table-striped table-bordered">
                            <tbody>
                                <tr>
                                    <th scope="row">Name</th>
                                    <td>{userName}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Phone No</th>
                                    <td>{shippingInfo?.phoneNo}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Address</th>
                                    <td>
                                        {shippingInfo?.address},
                                        {shippingInfo?.city},
                                        {shippingInfo?.country}
                                    </td>
                                </tr>
                            </tbody>
                        </table>

                        <h3 className="mt-5 mb-4">Payment Info</h3>
                        <table className="table table-striped table-bordered">
                            <tbody>
                                <tr>
                                    <th scope="row">Status</th>
                                    <td className="greenColor">
                                        <b>{paymentInfo?.status}</b>
                                    </td>
                                </tr>
                                <tr>
                                    <th scope="row">Method</th>
                                    <td>{order?.paymentMethod}</td>
                                </tr>
                                <tr>
                                    <th scope="row">Stripe ID</th>
                                    <td>stripe-id</td>
                                </tr>
                                <tr>
                                    <th scope="row">Amount Paid</th>
                                    <td>${totalAmount}</td>
                                </tr>
                            </tbody>
                        </table>

                        <h3 className="mt-5 my-4">Order Items:</h3>

                        <hr />
                        <div className="cart-item my-1">
                            {orderItems && orderItems.length > 0 ? (
                                orderItems.map((item, index) => (
                                    <div
                                        className="row my-5"
                                        key={item._id || index}
                                    >
                                        <div className="col-4 col-lg-2">
                                            <img
                                                src={item.image}
                                                alt={item.name}
                                                height="45"
                                                width="65"
                                            />
                                        </div>

                                        <div className="col-5 col-lg-5">
                                            <Link to={`/products/${item._id}`}>
                                                {item.name}
                                            </Link>
                                        </div>

                                        <div className="col-4 col-lg-2 mt-4 mt-lg-0">
                                            <p>${item?.price}</p>
                                        </div>

                                        <div className="col-4 col-lg-3 mt-4 mt-lg-0">
                                            <p>{item?.quantity}</p>
                                        </div>
                                    </div>
                                ))
                            ) : (
                                <p>No items found in this order</p>
                            )}
                        </div>
                        <hr />
                    </div>
                </div>
            </div>
        </>
    );
}

export default OrderDetails;
